---
title: 微信硬件之配网
date: 2018-11-23 09:57:19
tags:
	- 微信
---



有产品需要用微信来配网，现在看看是怎么来做的。



设备二维码分为两种：

1、标识唯一设备。

2、标识产品型号。

开发者可以调用微信后台接口生成的带设备编号的二维码。

用户在购买产品的时候，同时得到这个二维码，用户扫描二维码就可以绑定这个设备。

而对于标识型号的二维码，用户扫描二维码的时候，会通过局域网广播来绑定这个设备。

对于产品型号二维码，需要硬件的系统里继承微信的局域网发现协议AirKiss2.0 。



这里有演示视频，演示了配网和绑定，举例的是美的净水器。

https://v.qq.com/x/page/j0170txx5eb.html

配网，也是长按一个按键，进入到配网状态。



用户使用AirKiss的过程是这样：

1、用户按下设备的配网键，设备闪灯，指示进入到配网状态，准备接收消息。

2、用户打开微信，扫描二维码，安装提示填入wifi密码，点击连接。

这个过程大概15秒。

并没有把设备设置为ap状态，所以手机不需要切换网络。

这个是依赖设备wifi模组的硬件支持的广播行为。

所以，是需要用包含在支持列表里的wifi模组才能支持这个功能。



到这里下载库和头文件，选择ARM通用的这种。

https://iot.weixin.qq.com/wiki/new/index.html?page=4-1-4



第一步，申请产品型号二维码。

先要申请公众号。

然后在公众号里选择添加设备功能。

然后选择添加产品。

一个公众号可以添加多款产品。

所以我还是要申请一个微信公众号。但是这个要300元审核费的。还是让公司申请吧。



微信硬件产品能力定义说明

https://iot.weixin.qq.com/wiki/doc/intro/%E4%BA%A7%E5%93%81%E8%83%BD%E5%8A%9B%E5%AE%9A%E4%B9%89%E6%8C%87%E5%BC%95%20V1.2.pdf

这份文档提供了各种厂家产品的能力配置说明。

产品能力分为3种：

1、必选能力。

2、可选能力。

3、自定义能力。

产品能力集参考手册。

https://iot.weixin.qq.com/wiki/doc/intro/%E4%BA%A7%E5%93%81%E8%83%BD%E5%8A%9B%E9%9B%86%E5%8F%82%E8%80%83%E6%89%8B%E5%86%8CV1.3.pdf



# 设备接入方案

## 平台基础接入方案

这种方式的要求：

1、拥有自己的后台服务器。

2、希望设备可以收发微信消息。



我们应该采用直连方案，这样就不需要自己的后台服务器来跟微信服务器通信。

我们的设备直连到微信服务器。

微信官方说，因为Linux下cpu架构太多，需要下载申请表，让他们编译对应的。

一般需要rt和pthread的支持。

他们提供的东西2个文件（c++版本）：

```
WeChatAPI.h
libwxcloud.a
```

也有C语言的版本。



可以集成到esp8266上进行验证。所以这个资源占用是很少的。



# 参考资料

1、微信硬件平台

https://iot.weixin.qq.com/wiki/new/index.html?page=4-6

2、

https://blog.csdn.net/xh870189248/article/details/78677952