---
title: Linux命令之进程和性能篇
date: 2017-07-09 15:36:13
tags:

	-  Linux命令

---

本文是《Linux大棚命令百篇》的读书笔记。

# 1. uptime

这个命令是看开机时间的。输入格式如下：

```
 16:01:04 up 2 days,  5:00,  2 users,  load average: 0.00, 0.01, 0.05
```

最前面的16:01:04是当前时间，`up 2 days 5:00`表示开机了2天零5个小时。`2 users`表示当前有2个用户登录到这个系统了。`load average: 0.00, 0.01, 0.05`这3个值分别表示过去的1分钟、5分钟、15分钟的系统平均负载。

系统平均负载，可以用一个比喻来形容。

一个单核cpu可以看做一辆大巴。如果上面是空的，负载就是0.00，如果是每个人都有一个座位的满的状态，那么就是1.00。如果超过1.00了，说明有的人是没有座位的，是站着的，就是超载了。

一般要在0.7以下，超过0.7就要优化的。

类似的还可以看proc信息。前面3个数字还是表示负载，2/451，表示当前有2个进程运行，总共451个进程。最新的运行的进程的进程号是14508。

```
teddy@teddy-ubuntu:~$ cat /proc/loadavg 
0.08 0.05 0.05 2/451 14508
```



# 2. free

先看使用。

```
teddy@teddy-ubuntu:~$ free -m
             total       used       free     shared    buffers     cached
Mem:          3773       2008       1765         19        330       1113
-/+ buffers/cache:        564       3209
Swap:         3824          0       3824
```

重点解释一下buffers和cached。

当前的内存读写速度是60GB/s，而最快的SSD硬盘的速度是600MB/s。由此可见，两者的速度存在100倍的差距。

buffers是用来缓存要写入到硬盘是数据，而cached是用来缓存从硬盘读取出来的数据的。一个是读，一个是写。



# 3. swap分区理解

在现在，机械硬盘的价格大概是0.3/GB，固态硬盘是1.7元/GB，内存是45元/GB。

所以内存还是太贵了。所以要想办法减少内存。最成熟的方式就是用一部分的硬盘来模拟内存的swap技术了。

方案原理就是在内存不足时，把一部分暂时不用的内存写入到硬盘进行暂存，硬盘的这个位置就叫swap分区，一般设置为内存的2倍大。

其实当前，家用电脑是不需要这个的了，内存够大了，是给服务器用的。

之前的都是把一个硬盘分区来做swap用，现在改进了，可以用一个swap文件来做了。



# 4. vmstat

vmstat是用来监控Linux性能的工具。从名字上看，这个工具最初设计就是来查看虚拟内存的，只是后面功能扩展了。

`vmstat 1 4`。这个是Linux最常用的用发，1表示输出间隔，4表示输出次数。

```
teddy@teddy-ubuntu:~$ vmstat 1 4
procs -----------memory---------- ---swap-- -----io---- -system-- ------cpu-----
 r  b   swpd   free   buff  cache   si   so    bi    bo   in   cs us sy id wa st
 0  0      0 1783644 339424 1142860    0    0     1     2   15   21  0  0 100  0  0
 0  0      0 1783520 339424 1142888    0    0     0     0   89  172  0  0 100  0  0
 0  0      0 1783520 339424 1142888    0    0     0     0  272  179  0  0 100  0  0
 0  0      0 1783520 339424 1142888    0    0     0     0  108  200  0  1 99  0  0
```

这个第一行不要管，第一行是不能反映真实情况的，忽略第一行，所以这个命令默认也是输出两行的。

第一行是服务器开机到目前的平均值。

`vmstat -f`。这个查看Linux调用fork的次数。可以定时查询这个值，看看是不是有太多的异常fork导致性能激增。其实你执行一下这个命令，也是一个fork，会让这个值加1的。



# 5. mpstat

这个命令需要另外安装，是sysstat里的一部分。

mp是多核的英文缩写。所以这个命令就是进行多核统计的。



```
teddy@teddy-ubuntu:~$ mpstat -P ALL 1
Linux 4.2.0-16-generic (teddy-ubuntu) 	2017年07月09日 	_i686_	(4 CPU)

16时33分58秒  CPU    %usr   %nice    %sys %iowait    %irq   %soft  %steal  %guest  %gnice   %idle
16时33分59秒  all    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00  100.00
16时33分59秒    0    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00  100.00
16时33分59秒    1    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00  100.00
16时33分59秒    2    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00  100.00
16时33分59秒    3    0.99    0.00    0.99    0.00    0.00    0.00    0.00    0.00    0.00   98.02

```

