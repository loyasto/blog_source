---
title: 《深入理解linux内核》读书笔记
date: 2018-01-08 10:23:20
tags:
	- Linux内核

---



# 第八章 内存管理

整个系统的性能取决于如何有效地管理动态内存。

内核必须记录每个page的当前状态，

1、区分哪些page是属于进程的。

2、哪些page是属于内核代码或者内核数据。

page里可能包含的数据有：

1、包含app的数据。

2、包含app的高速缓存的数据。

3、动态分配的内核的数据结构。

4、驱动缓冲的数据。

5、内核模块的代码。

struct page的大小大概32个字节（根据配置不同，会变动）。

所有的page被一个全局的链表连接起来。

```
struct page *mem_map;
```

struct page有7个成员：

```
1、ulong flags
2、_count 引用计数，为-1，表示空闲。
3、
```



为GFP_ATOMIC这种原子分配，保留了一个页框池。

# 第九章 进程地址空间

在内核里，用直接的方式来获得动态内存。

这个是基于这样的原则来设计的：

1、内核是整个系统里优先级最高的部分，如果内核请求内存，没有必要去推迟了。

2、内核信任自己。

但是对于用户态程序，则是这样的原则：

1、App对内存的请求被认为是不紧急的。

2、App被认为是不可信任的。



普通的进程的vma一般只有十几个。但是对于数据库应用，可能是上千个，链表进行管理就非常低效了。

所以需要红黑树。



