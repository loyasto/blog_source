---
title: Linux内核之进程（二）调度
date: 2018-04-04 14:03:51
tags:
	- Linux内核

---



# 多任务

多任务系统可以分为两类：

1、非抢占式。

2、抢占式。

非抢占式是比较落后，除非进程自己主动让出，否则会一直执行。

如果进程一直不让出，程序就会崩溃。

# linux的进程调度

从最初的linux版本，一直到linux2.4版本，它的调度程序都是非常简陋的。设计近乎原始。

当然，它很容易理解，但是难当大任。

正因为如此，在linux2.5版本开始，调度程序做了大手术。引入了一个叫O(1)的调度程序。之所以叫O(1)，是因为它的时间复杂度是O(1)。

O(1)调度程序，在进程数量不超过100个的时候，表现是很完美的。

但是，人们很快发现，这种调度程序对于交互程序表现非常差。

所以O(1)对于服务器场景是比较好的，但是对于桌面场景表现不好。

所以2.6版本，继续对调度程序进行大手术。在2.6.23版本里，完全公平调度算法(CFS)代替了O(1)调度调度算法走上了历史舞台。

# 策略

进程可以分为两种类型：

1、io消耗型。有大量的io操作。特点是经常处于可运行状态，但是运行只很短一会儿，因为大部分要等io。GUI就是io消耗型的。

2、CPU消耗型。有大量的计算。编译器就是了。

调度策略，就是要在响应的速度和系统的效率之间寻找平衡。

一般是优先调度io消耗型的。

# 进程优先级

调度算法里，最基本的一种就是基于优先级的调度。

linux里采用了2种不同的优先级范围：

1、用nice值。范围是-20到19 。默认为0 。值越大，优先级越低。

2、实时优先级。范围是0到99 。这个是值越大，优先级越高。



# 时间片

时间片是一个数值，它表示的是进程在被抢占之前，可以持续运行的时间。

调度策略必修固定一个默认的时间片。这个里面大有学问。太长太短都不好。



# linux调度算法

linux里的调度器是以模块的方式提供的。

这样的目的是允许不同的类型的进程可以选择调度算法。

所以有一个调度器类的概念。它允许多个调度算法共存。调度属于自己管辖的进程。

每个调度器也有一个优先级。

调度器的基础代码在kernel/sched.c里，它会按照优先级顺序遍历调度器类。



CFS调度算法在kernel/sched_fair.c里。这个文件有4000行代码。



# 参考资料

1、《Linux内核设计与实现》第4章