---
title: 蓝牙之基本认识
date: 2017-08-25 23:50:32
tags:

	- 无线

	- 蓝牙

---

工作中一直没有接触蓝牙，所以基本没有什么认识。现在要进行系统的学习。

# 蓝牙的版本

蓝牙最初是爱立信于1994年提出，当时是作为RS232数据线的替代方案。

经常看到蓝牙X.0这种版本号，那么现在最新版本是多少？各个版本之间的区别是什么呢？

总的来说，蓝牙协议经历过4个大的版本更新，分别是1.0、2.0、3.0、4.0。现在最新的就是4.0。各大版本直接有小版本更新。暂时不关注这么细。

1.0的不讨论了，太老了，市面上没有相关产品了。

2.0这一代的，主要是2.1在用。第二代提高了3到10倍的速度，功耗有降低，支持了立体声。

3.0这一代，速度有质的飞跃，相比第二代提高了8倍左右，使得蓝牙传输视频成为可能，功耗上没有增加。

4.0这一代，主要是在功耗上降低了。传输距离可以到100米。目前4.1的协议已经出来了。

总的来说，蓝牙分为经典蓝牙（classic Bluetooth）和低功耗蓝牙（Bluetooth Low Energy，BLE）。



#  蓝牙的无线通信相关参数

使用了2.402G到2.480G这个频段。被分割为79个频道，一个频道的宽度是1MHz。蓝牙4.0开始使用2MHz的宽度，所以频道缩减为40个。

通信会根据情况在这些频道之间切换，以求得到好的通信。

属于微波波段，跟微波炉发出的波是接近的，所以微波炉会对蓝牙和WiFi的通信都产生影响。

2.4GHz的无线波，波长大概是12.5cm这种级别。属于特高频。高频信号的特点是：传输速度快、穿透能力强、但是距离有限。蓝牙设备的实际通信距离在2到5米。





# 什么是蓝牙微微网？

蓝牙设备直接可以建立两种网络拓扑，一种是微微网（piconet），一种是分散网（scatternet）。

在微微网中，一个蓝牙设备，要么是Master，要么是Slave，而且只有一个Master。设备使用3个bit来进行编号，所以最多是一个Master，7个Slave。

Slave之间不能通行，Slave只能跟Master通信。这个很类似Modbus的网络情况。



#  蓝牙的基本工作流程

1、广播/扫描。

2、连接。

3、数据通信。



# 低功耗蓝牙BLE

BLE的主要的特点是通信的双方设计得非对称，让其中一方多承担开销，另外一方减少开销。

以智能手环为例，把开销主要放到手机这边来，手环的开销小，待机时间就可以长。

BLE的数据传输协议是ATT和GATT协议。

ATT协议把通信双方分为server和client。client向server发起读写操作。

在手环应用里，手环是server，手机是client。

ATT协议里，一个attribute是通信单位。一个attribute的格式如下：

`handle  type   value  permission`

handle：就是一个id。长度16位，唯一标识attribute。

type：类型。

value：属性值。

permission：分为无、R、W、RW。

server存储了多个attribute，当client请求的时候，server会把自己的attribute列表发给client。



还是以智能手环为例，手环和手机配对后，手机读取手环里保存的步数数据。

通信过程中，都是手机采取主动。手环被动应答。

ATT还是提供了server发出notification的功能的。例如手环里的手势识别，就可以通知给手机。



# 经典蓝牙

经典蓝牙是早期的蓝牙。经典蓝牙的传输协议的串行仿真协议RFCOMM。这个协议仿真了常见的串口连接。

经典蓝牙的缺点是功耗高。是诺基亚主导改进的。

