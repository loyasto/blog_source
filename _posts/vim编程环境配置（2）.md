---
title: vim编程环境配置（2）
date: 2016-10-30 22:40:50
tags:
	- vim
---
第一篇文章已经讲了vim环境的基本配置，我用这个配置来进行一些代码编辑工具，发现了一些不方便的地方，所以还可以继续做下面的完善。


### 1. 内核头文件的补全
在进行驱动开发的时候，需要使用内核头文件来帮助进行代码补全。前面已经对C库的基本头文件生成了systags标签文件，放在~/.vim目录下了。这个操作也类似。
先要安装系统头文件。
```
sudo apt-get install linux-headers-`uname -r`
```
安装的目标地址是`/usr/src/`目录。例如我当前安装后的效果是这样：
```
teddy@teddy-ubuntu:/usr/src$ ls -l
总用量 8
drwxr-xr-x 24 root root 4096 10月 21  2015 linux-headers-4.2.0-16
drwxr-xr-x  7 root root 4096 10月 21  2015 linux-headers-4.2.0-16-generic
```
针对这个头文件目录生成tags文件。
```
ctags --file-scope=yes --langmap=c:+.h --languages=c,c++ --links=yes --c-kinds=+p --fields=+S  -R -f ~/.vim/drivertags /usr/src/linux-headers-4.2.0-16
```
然后在~/.vimrc里加入：
```
set tags+=~/.vim/drivertags
```
现在新建一个c文件，输入一个内核头文件里的某个函数的一部分，然后按Ctrl+N，就可以看到系统进行了自动补全了。

### 2. 自动保存
在编辑过程中，需要时不时跳转到函数原型文件去看看，然后vim就会提示当前文件还没有保存，这个无疑很麻烦。
而且vim的保存`:w`敲起来真是麻烦啊。
一般编辑器都有自动保存的功能，vim当然也有，把这个功能配上。
操作方法是，在.vimrc里加入这句：
```
set autowriteall
```
这样在你进行函数跳转的时候，当前文件就会被自动保存了。
不过要注意了，这样的话，你每次改过的文件，都会被自动保存，即使你是用`:q`来退出，也不会再提示你进行保存了。
### 3. 代码块的自动完成
经常输入if、while、for这种代码块，也挺繁琐的，很多ide都可以帮你自动完成这种代码块。
上网搜了一下，发现snipmate这个插件不错，但是从安装上来看，就比较麻烦了，而且安装就是一堆的插件，这个与我的简单化的原则相背离，所以不做了。

### 4. vim会话保存和载入自动化处理
前面讲到过保存会话和载入会话的操作，不过都是手动执行的，尤其是每次退出时都要保存，麻烦。






