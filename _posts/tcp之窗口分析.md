---
title: tcp之窗口分析
date: 2017-11-02 21:29:32
tags:
	- tcp
	- 网络

---



# 窗口分类

按照长度是否可以变化，tcp的窗口分为2类：

1、固定窗口。

2、滑动窗口。



又可以分为2种：

1、滑动窗口。对于接收方而已。

2、拥塞窗口。对于发送方而言。在一个RTT里，可以发送的最多的数据包数。



滑动窗口协议是传输层进行流控的一种手段。

接收方通过告诉发送方自己的窗口大小，从而控制发送方的发送速度，避免因为对方发送过快而自己处理不过来。



ack包含了2个重要的信息。

1、期望收到的下一个字节的序号n。例如，接收方收到1到1024个字节，它就会发送一个1025的ack，如果接下来收到的是2049到3072的，它仍然是发送1025的ack。

2、当前的窗口的大小m。这样，发送方在收到接收方的ack之后，就可以用m和n来算出自己还可以发多少数据。

假设当前已经发送了x个字节。那么可以发送的y就这样计算：`y = m - (x - n)`。



# 滑动窗口作用

有2个作用：

1、提供tcp的可靠性。

2、提供流控。





#来由分析

一个简单的传输协议可以使用这样的原则：

1、发送一个报文，等待对方确认。

2、收到确认，再发下一个报文。

3、如果没有收到确认，且超时，就重发。

这样虽然简单可靠，但是，效率低。

我们称之为**停止等待协议**。停止等待协议是滑动窗口协议里，窗口为1的情况。



我们把规则改成这样：

1、在一个时间窗口内，发送方能够在没有收到ACK的情况下，发送自己的所有报文，但是，每个报文都对应一个启动的定时器。

2、接收方必须确定收到的每个报文，指示最后一个正确收到的报文的序列号。

3、发送方在收到每个ACK的时候，滑动窗口。

简单说就是这样，假设当前的窗口是5，先一口气发5个包，然后收到了第一个包的ack，然后就可以发第6个包的了。就相当于窗口往前滑动了一格。



当滑动窗口变成1的时候，就变成了最简单的那种原则的方式了。





滑动窗口本质上是描述接收方的tcp 数据包buffer的大小。

发送方根据这个来计算自己可以发多少东西出去。

如果接收方的窗口为0了，那么发送方就会停止发送。



tcp的流量控制就是在序号和窗口大小上做文章。



滑动窗口协议，是用来保证tcp的可靠性和进行流量控制的机制。

滑动窗口，先看看什么是窗口。

窗口对应一段可以被发送者发送的字节序列，序列连续的范围称为“窗口”。

滑动该怎么理解呢？

就是指窗口的范围是可以在发送过程中变化的。



在进一步理解之前，先要清楚这几点：

1、tcp协议的通信双方，分别是发送者A和接受者B。因为是全双工的协议，所以A和B应该分别维护着一个独立的发送buffer和接收buffer。

2、发送窗口是发送buffer的一部分。

3、发送窗口相关的有4个概念：

​	已发送且已收到确认的。（这个已经不在发送窗口和发送buffer里了）

​	已发送还未收到确认的。（在发送窗口中）

​	允许发送但是还没有发送的。

​	不允许发送的（在buffer里，但是在发送窗口外）

4、在每次数据发送成功后，发送窗口就会在发送缓冲区里按顺序移动。将新的数据包含到窗口里，准备发送。

这个网站有个动画演示：

http://www.exa.unicen.edu.ar/catedras/comdat1/material/Filminas3_Practico3.swf

很简单直观的。



在A和B刚刚建立tcp连接时，B告诉A自己的接收窗口的大小是20字节。

